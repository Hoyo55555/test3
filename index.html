<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¬¬å…«ç¯€è¼”å°èª²ï¼šæ²ˆå¾©èˆ‡èŠ¸å¨˜çš„ç”œèœœæˆ°çˆ­</title>
    <style>
        :root {
            /* æƒ…ä¾¶å¤é¢¨é…è‰² */
            --primary: #e056fd; /* èŠ¸å¨˜ç´«ç²‰ */
            --primary-light: #fbeaff;
            --secondary: #0984e3; /* æ²ˆå¾©è— */
            --secondary-light: #e1f0ff;
            --accent: #fdcb6e; /* è¨»é‡‹é»ƒ */
            --text: #2d3436;
            --wood: #a2785c; /* æœ¨ç‰Œè‰² */
            --wood-dark: #63432d;
            --bg: #dfe6e9;
            --card-bg: rgba(255, 255, 255, 0.98);
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
        }

        body {
            font-family: "Microsoft JhengHei", "PingFang TC", serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg);
            background-image: linear-gradient(30deg, #dcdde1 12%, transparent 12.5%, transparent 87%, #dcdde1 87.5%, #dcdde1), linear-gradient(150deg, #dcdde1 12%, transparent 12.5%, transparent 87%, #dcdde1 87.5%, #dcdde1), linear-gradient(30deg, #dcdde1 12%, transparent 12.5%, transparent 87%, #dcdde1 87.5%, #dcdde1), linear-gradient(150deg, #dcdde1 12%, transparent 12.5%, transparent 87%, #dcdde1 87.5%, #dcdde1), radial-gradient(#ced6e0 20%, transparent 20%);
            background-size: 80px 140px;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            color: var(--text);
        }

        /* 1920x1080 å®¹å™¨ */
        .slide-container {
            width: 1920px;
            height: 1080px;
            max-width: 100vw;
            max-height: 100vh;
            aspect-ratio: 16 / 9;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 8px solid white;
        }

        /* è£é£¾æ¡†ç·š */
        .slide-container::after {
            content: "";
            position: absolute;
            top: 15px; left: 15px; right: 15px; bottom: 15px;
            border: 2px solid var(--primary);
            border-radius: 15px;
            pointer-events: none;
            opacity: 0.3;
            z-index: 0;
        }

        .slide {
            display: none;
            flex: 1;
            padding: 20px 60px;
            flex-direction: column;
            align-items: center;
            animation: fadeIn 0.5s ease;
            height: 100%;
            overflow-y: hidden; 
            position: relative;
            z-index: 1;
        }

        .slide.active { display: flex; }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        h1 { font-size: 3.5rem; margin: 10px 0; color: #d63031; text-shadow: 2px 2px 0px white; letter-spacing: 5px; text-align: center; font-family: "KaiTi", serif; font-weight: bold; }
        h2 { font-size: 2rem; margin-bottom: 15px; color: #636e72; background: linear-gradient(to top, var(--accent) 40%, transparent 40%); padding: 0 10px; border-radius: 5px; }

        /* å°èˆªæŒ‰éˆ• */
        .nav-controls {
            position: absolute;
            bottom: 25px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            padding: 0 50px;
            pointer-events: none;
            z-index: 50;
        }

        .nav-btn {
            pointer-events: auto;
            background: white;
            color: var(--text);
            border: 2px solid var(--text);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 3px 3px 0px rgba(0,0,0,0.2);
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .nav-btn:hover { background: var(--text); color: white; transform: translate(-2px, -2px); box-shadow: 5px 5px 0px rgba(0,0,0,0.2); }
        .nav-btn:active { transform: translate(0, 0); box-shadow: none; }
        .nav-btn.disabled { opacity: 0.3; cursor: not-allowed; filter: grayscale(1); }

        /* Slide 1: å°é¢è¨­è¨ˆ (SVG) */
        .hero-visual { margin: 30px; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% {transform: translateY(0);} 50% {transform: translateY(-10px);} }

        /* Slide 2: åŸæ–‡ (ç¿»é å¼) & å½±ç‰‡ */
        .text-layout-v {
            display: flex;
            flex-direction: column;
            width: 95%; /* æ‹‰å¯¬ */
            height: 90%; /* æ‹‰é•· */
            gap: 15px;
            position: relative;
        }
        
        .video-btn {
            position: absolute;
            top: -60px;
            right: 0;
            background: #ff7675;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 10;
        }
        .video-btn:hover { background: #d63031; transform: scale(1.05); }

        .text-book-container {
            flex: 6; /* å¢åŠ ä½”æ¯” */
            position: relative;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.1);
            overflow: hidden; /* éš±è—è¶…å‡ºéƒ¨åˆ† */
            display: flex;
            flex-direction: column;
            perspective: 1500px; /* 3D è¦–è§’ */
        }

        .text-page {
            flex: 1;
            padding: 40px 80px; 
            font-size: 2.2rem; 
            line-height: 2;
            text-align: justify;
            font-family: "KaiTi", "BiauKai", serif;
            display: none;
            color: #2d3436;
            background: white;
            /* ç¿»é å‹•ç•«ç›¸é—œ */
            transform-origin: left center;
            backface-visibility: hidden;
            width: 100%;
            height: 100%;
            position: absolute; /* é‡ç–Š */
            top: 0; left: 0;
            overflow-y: auto;
        }

        .text-page.active { 
            display: block; 
            animation: flipIn 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
            z-index: 2;
        }
        
        .text-page.leaving {
            display: block;
            animation: flipOut 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
            z-index: 1;
        }

        @keyframes flipIn {
            from { transform: rotateY(-90deg); opacity: 0; }
            to { transform: rotateY(0); opacity: 1; }
        }
        @keyframes flipOut {
            from { transform: rotateY(0); opacity: 1; }
            to { transform: rotateY(90deg); opacity: 0; }
        }

        .pagination {
            height: 50px;
            background: #f1f2f6;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            border-top: 1px solid #ddd;
            z-index: 10; /* ç¢ºä¿æŒ‰éˆ•åœ¨æœ€ä¸Šå±¤ */
            position: absolute; bottom: 0; width: 100%;
        }
        .page-btn {
            background: none; border: none; cursor: pointer; font-size: 1.2rem; font-weight: bold; color: #555;
            padding: 5px 15px; border-radius: 20px; transition: 0.2s;
        }
        .page-btn:hover { background: #dfe6e9; }
        .page-btn:disabled { color: #ccc; cursor: default; }

        .note-panel-v {
            flex: 1; /* ç¸®å°ä½”æ¯” */
            background: #fffdf0;
            border: 2px dashed #b2bec3;
            border-radius: 15px;
            padding: 10px 20px;
            overflow-y: auto;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-content: center;
        }
        .note-item {
            font-size: 1.1rem;
            background: white;
            padding: 5px 12px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border: 1px solid #dfe6e9;
        }
        .note-key { color: #d63031; font-weight: bold; margin-right: 5px; }
        .highlight { background-color: var(--accent); padding: 0 5px; border-radius: 5px; cursor: help; color: #000; }

        /* Slide 3: ç•«å¸ƒ */
        .canvas-wrapper {
            width: 800px;
            height: 450px;
            background: white;
            border: 4px solid var(--text);
            border-radius: 15px;
            position: relative;
            cursor: crosshair;
            box-shadow: 5px 5px 0px rgba(0,0,0,0.1);
        }
        .paint-tools { display: flex; gap: 15px; margin-top: 15px; }
        .color-btn { width: 45px; height: 45px; border-radius: 50%; border: 3px solid #ddd; cursor: pointer; transition: 0.2s; }
        .color-btn.active { transform: scale(1.1); border-color: #000; box-shadow: 0 0 10px rgba(0,0,0,0.2); }
        .ctrl-btn { 
            font-size: 1.2rem; padding: 10px 25px; cursor: pointer; border: 2px solid var(--text); 
            background: white; color: var(--text); border-radius: 50px; 
            font-weight: bold; box-shadow: 3px 3px 0px rgba(0,0,0,0.1); margin: 0 10px;
            transition: 0.1s;
        }
        .ctrl-btn:active { transform: translate(2px, 2px); box-shadow: none; }
        .ctrl-btn.primary { background: var(--primary); color: white; border-color: var(--primary); }
        .ctrl-btn.secondary { background: #636e72; color: white; border-color: #636e72; }

        /* Slide 4: å°è©± (æ›´æ–°) */
        .chat-container {
            width: 85%; background: rgba(255,255,255,0.8); border-radius: 20px;
            padding: 30px; flex: 1; display: flex; flex-direction: column; gap: 25px;
            overflow-y: auto; margin-bottom: 20px;
        }
        .chat-row {
            display: flex; gap: 15px; max-width: 90%; align-items: flex-start;
        }
        .chat-row.shen { align-self: flex-start; }
        .chat-row.yun { align-self: flex-end; flex-direction: row-reverse; }

        .avatar-group { display: flex; flex-direction: column; align-items: center; gap: 5px; min-width: 100px; }
        .avatar-name { font-size: 1rem; font-weight: bold; color: #636e72; background: rgba(255,255,255,0.8); padding: 2px 8px; border-radius: 10px; }
        .avatar-svg { width: 110px; height: 110px; filter: drop-shadow(0 3px 3px rgba(0,0,0,0.1)); transition: 0.3s; }
        .avatar-svg:hover { transform: scale(1.1); }

        .chat-bubble {
            padding: 15px 25px; border-radius: 20px; font-size: 1.6rem;
            position: relative; cursor: pointer; box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            background: white; border: 2px solid #dfe6e9; min-height: 50px; 
            transition: 0.3s; margin-top: 25px;
        }
        .chat-bubble:hover { transform: translateY(-2px); border-color: var(--secondary); }
        .chat-row.yun .chat-bubble { background: var(--primary-light); border-color: #ffcdd2; }
        .chat-row.yun .chat-bubble:hover { border-color: var(--primary); }

        .chat-text { opacity: 0; display: none; font-family: "KaiTi", serif; font-weight: bold; font-size: 1.8rem; }
        .chat-trans { opacity: 0; display: none; font-size: 1.3rem; color: #d63031; margin-top: 8px; border-top: 1px dashed rgba(0,0,0,0.2); padding-top: 8px; }
        .placeholder { color: #b2bec3; font-size: 2rem; font-weight: bold; letter-spacing: 5px; }

        /* Slide 5: ä¸‰æ­¥é©Ÿ */
        .step-container { display: flex; justify-content: space-around; width: 100%; height: 60%; align-items: center; }
        .step-box {
            text-align: center; opacity: 0.3; transform: scale(0.9); transition: 0.5s; cursor: pointer;
            background: white; padding: 25px; border-radius: 20px; width: 280px; pointer-events: auto;
            border: 3px solid transparent;
        }
        .step-box:hover { opacity: 0.6; }
        .step-box.active { opacity: 1; transform: scale(1.1); box-shadow: 0 10px 30px rgba(0,0,0,0.15); border-color: var(--secondary); }
        .step-emoji { font-size: 6rem; display: block; margin-bottom: 10px; }
        
        #step-success-msg {
            position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%);
            background: #00b894; color: white; padding: 15px 30px; border-radius: 50px;
            font-size: 2rem; font-weight: bold; box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            opacity: 0; pointer-events: none; transition: 0.5s;
        }

        /* Slide 6: ç‰¹è³ªåˆ†é¡ (æœ¨ç‰Œèˆ‡ä¿®å¾©) */
        .sort-game-container {
            display: flex; width: 100%; height: 75%; gap: 30px; position: relative;
        }
        .zone {
            flex: 1; border-radius: 20px; display: flex; flex-direction: column; align-items: center; padding: 20px;
            transition: 0.3s; border: 4px dashed rgba(0,0,0,0.2); background: rgba(255,255,255,0.6);
            position: relative;
        }
        .zone.hover { background: rgba(255, 234, 167, 0.3); border-color: var(--text); transform: scale(1.02); }
        .zone.selected-target { background: rgba(253, 121, 168, 0.1); border-color: var(--primary); box-shadow: 0 0 15px rgba(253, 121, 168, 0.3); } 
        .zone h3 { font-size: 1.8rem; margin: 10px 0; font-family: "KaiTi", serif; font-weight: bold; }
        .zone-content { width: 100%; flex: 1; display: flex; flex-wrap: wrap; align-content: flex-start; gap: 10px; justify-content: center; padding-top: 20px; pointer-events: none; } 
        .zone-content .trait-card { pointer-events: auto; }

        .deck-area {
            position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 80%; height: 120px; background: rgba(255,255,255,0.9); border-radius: 20px 20px 0 0;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1); padding: 10px; display: flex; justify-content: center; gap: 20px; align-items: center;
            z-index: 10;
        }

        /* æœ¨ç‰Œç‰¹è³ªå¡ */
        .trait-card {
            background: var(--wood);
            color: #fff;
            padding: 12px 20px;
            border-radius: 5px;
            font-size: 1.5rem;
            cursor: grab;
            box-shadow: 2px 4px 5px rgba(0,0,0,0.3), inset 0 0 10px rgba(0,0,0,0.2);
            transition: transform 0.1s; 
            touch-action: none;
            position: relative; 
            z-index: 100;
            font-family: "KaiTi", serif;
            border: 2px solid var(--wood-dark);
            text-shadow: 1px 1px 0px var(--wood-dark);
            min-width: 100px; text-align: center;
        }
        .trait-card::before { 
            content: ""; position: absolute; top: 5px; left: 50%; transform: translateX(-50%);
            width: 6px; height: 6px; background: #333; border-radius: 50%; box-shadow: inset 0 1px 1px rgba(255,255,255,0.2);
        }
        .trait-card:active { cursor: grabbing; transform: scale(1.05); }
        .trait-card.correct { background: #00b894; border-color: #006266; pointer-events: none; }
        .trait-card.wrong { background: #d63031; border-color: #c0392b; animation: shake 0.4s; }
        .trait-card.selected { border: 3px solid #fd79a8; transform: scale(1.1); box-shadow: 0 0 15px rgba(253, 121, 168, 0.5); }

        @keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-5px);} 75% {transform: translateX(5px);} }

        /* å®ŒæˆæŒ‰éˆ• */
        #check-btn {
            position: absolute; top: -70px; right: 0;
            padding: 15px 40px; font-size: 1.5rem; background: var(--secondary); color: white;
            border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: none; z-index: 200; font-family: inherit; font-weight: bold;
        }
        #check-btn:hover { background: #0c2461; transform: scale(1.05); }

        /* Slide 7: é‡é»æ•´ç† */
        .summary-card {
            background: white;
            width: 80%;
            height: 70%;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow-y: auto;
            border-left: 10px solid var(--primary);
        }
        .summary-title { font-size: 2rem; color: var(--text); margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 10px; font-weight: bold; }
        .summary-list { list-style: none; padding: 0; font-size: 1.6rem; line-height: 2; }
        .summary-list li { margin-bottom: 15px; display: flex; align-items: flex-start; }
        .summary-list li::before { content: "â˜…"; color: var(--accent); margin-right: 15px; font-size: 1.5rem; }
        .highlight-text { color: #d63031; font-weight: bold; padding: 0 5px; }

        /* æ¨¡æ…‹æ¡† (å…±ç”¨) */
        .modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 999;
        }
        .modal-box {
            background: white; padding: 40px; border-radius: 20px; text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4); max-width: 800px;
            animation: popIn 0.3s; position: relative;
        }
        .video-container {
            position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; width: 640px; background: #000;
        }
        .video-container iframe {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        }
        
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    </style>
</head>
<body>

<div class="slide-container">
    
    <!-- Slide 1: å°é¢ -->
    <div class="slide active" id="s1">
        <div style="flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center;">
            <h1>æ²ˆå¾©èˆ‡èŠ¸å¨˜çš„ç”œèœœæˆ°çˆ­</h1>
            <h2>ã€Šæµ®ç”Ÿå…­è¨˜ãƒ»é–¨æˆ¿è¨˜æ¨‚ã€‹</h2>
            
            <div class="hero-visual">
                <!-- å¤é¢¨é£¯ç¢—èˆ‡æ„›å¿ƒ SVG -->
                <svg width="250" height="250" viewBox="0 0 200 200">
                    <defs>
                        <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
                            <feGaussianBlur stdDeviation="2" result="blur"/>
                            <feComposite in="SourceGraphic" in2="blur" operator="over"/>
                        </filter>
                    </defs>
                    <!-- Steam Heart -->
                    <path d="M100,50 Q120,20 140,50 T140,90 Q100,130 100,130 Q60,90 60,50 T100,50" fill="#e056fd" opacity="0.6">
                        <animate attributeName="transform" type="translate" values="0,0; 0,-10; 0,0" dur="3s" repeatCount="indefinite"/>
                        <animate attributeName="opacity" values="0.6; 0.3; 0.6" dur="3s" repeatCount="indefinite"/>
                    </path>
                    <!-- Bowl -->
                    <path d="M30,120 Q100,200 170,120 L170,110 L30,110 Z" fill="#74b9ff" stroke="#2d3436" stroke-width="3"/>
                    <ellipse cx="100" cy="110" rx="70" ry="10" fill="#a29bfe"/>
                    <!-- Chopsticks -->
                    <line x1="60" y1="20" x2="120" y2="120" stroke="#fdcb6e" stroke-width="6" stroke-linecap="round"/>
                    <line x1="80" y1="20" x2="140" y2="120" stroke="#fdcb6e" stroke-width="6" stroke-linecap="round"/>
                </svg>
            </div>

            <p style="font-size: 1.5rem; color: #636e72;">ã€ä»Šæ—¥ä¸»é¡Œã€‘èˆŒå°–ä¸Šçš„å¤«å¦»æ”»é˜²æˆ°</p>
            <button class="ctrl-btn primary" style="margin-top:30px; font-size:1.5rem; padding:15px 40px;" onclick="move(1)">é–‹å§‹ä¸Šèª² â–¶</button>
        </div>
    </div>

    <!-- Slide 2: åŸæ–‡ (ç¿»é å‹•ç•«å¼) & å½±ç‰‡ -->
    <div class="slide" id="s2">
        <h2>ğŸ“œ åŸæ–‡å°ç…§èˆ‡è¨»é‡‹</h2>
        <div class="text-layout-v">
            <button class="video-btn" onclick="openVideoModal()">ğŸ“º èª²å‰é ç¿’æ™‚é–“</button>
            <div class="text-book-container">
                <!-- Page 1 -->
                <div class="text-page active" id="text-page-1">
                    èŠ¸å–œé£Ÿ<span class="highlight">èŠ¥é¹µä¹³è…</span>â‘ ï¼Œåˆå–œé£Ÿè¦é¹µç“œã€‚æ­¤äºŒç‰©ä½™ç”Ÿå¹³æ‰€æœ€æƒ¡è€…ï¼Œå› æˆ²ä¹‹æ›°ï¼šã€Œç‹—ç„¡èƒƒè€Œé£Ÿç³ï¼Œ<span class="highlight">èœ£è‚</span>â‘¡åœ˜ç³è€ŒåŒ–èŸ¬ã€‚å¿å…¶ç‹—è€¶ï¼ŸèŸ¬è€¶ï¼Ÿã€<br><br>
                    èŠ¸æ›°ï¼šã€Œè…å–å…¶åƒ¹å»‰è€Œå¯ç²¥å¯é£¯ï¼Œå¹¼æ™‚é£Ÿæ…£ï¼›è‡³é¹µç“œä¹‹å‘³ï¼Œåˆ°æ­¤åˆå˜—è€³ã€‚ã€<br><br>
                    ä½™æ›°ï¼šã€Œç„¶å‰‡æˆ‘å®¶ä¿‚<span class="highlight">ç‹—ç«‡</span>â‘¢è€¶ï¼Ÿã€
                </div>
                <!-- Page 2 -->
                <div class="text-page" id="text-page-2">
                    èŠ¸çª˜è€Œå¼·è§£æ›°ï¼šã€Œå¤«ç³ï¼Œäººå®¶çš†æœ‰ä¹‹ï¼Œè¦åœ¨é£Ÿèˆ‡ä¸é£Ÿä¹‹åˆ¥è€³ã€‚è…ä¸æ•¢<span class="highlight">å¼·</span>â‘£ï¼Œç“œå¯æ‰¼é¼»ç•¥å˜—ã€‚ã€<br><br>
                    ä½™ç¬‘æ›°ï¼šã€Œå¿é™·æˆ‘ä½œç‹—è€¶ï¼Ÿã€èŠ¸æ›°ï¼šã€Œå¦¾ä½œç‹—ä¹…çŸ£ã€‚ã€ä»¥ç®¸å¼·å¡ä½™å£ã€‚<br><br>
                    ä½™æ©é¼»å’€åš¼ä¹‹ï¼Œä¼¼è¦ºè„†ç¾ï¼Œé–‹é¼»å†åš¼ï¼Œç«Ÿæˆç•°å‘³ï¼Œå¾æ­¤äº¦å–œé£Ÿã€‚
                </div>
                
                <div class="pagination">
                    <button class="page-btn" id="prev-page" onclick="changePage(-1)" disabled>â® ä¸Šä¸€é </button>
                    <span id="page-num" style="font-size:1.2rem;">1 / 2</span>
                    <button class="page-btn" id="next-page" onclick="changePage(1)">ä¸‹ä¸€é  â¯</button>
                </div>
            </div>
            
            <div class="note-panel-v">
                <div class="note-item"><span class="note-key">1. èŠ¥é¹µä¹³è…ï¼š</span>è‡­è±†è…ã€‚</div>
                <div class="note-item"><span class="note-key">2. èœ£è‚ï¼š</span>éŸ³ ã„‘ã„§ã„¤ ã„Œã„¤ËŠï¼Œå±æ®¼éƒã€‚</div>
                <div class="note-item"><span class="note-key">3. ç‹—ç«‡ï¼š</span>ç‹—æ´ã€‚ç«‡ï¼ŒéŸ³ã„‰ã„¡Ë‹ï¼Œå­”ç©´ã€‚</div>
                <div class="note-item"><span class="note-key">4. å¼·ï¼š</span>éŸ³ ã„‘ã„§ã„¤Ë‡ï¼Œè¿«ä½¿ã€ä½¿ç”¨å¼·åŠ›ã€‚</div>
            </div>
        </div>
    </div>

    <!-- Slide 3: ç•«å¸ƒ -->
    <div class="slide" id="s3">
        <h2>ğŸ¨ ä½ ç•«æˆ‘çŒœï¼šå…©æ¥µåŒ–é£Ÿç‰©</h2>
        <p>è«‹ç•«å‡ºï¼šã€Œå–œæ­¡èˆ‡è¨å­å¾ˆå…©æ¥µçš„é£Ÿç‰©ã€(ä¾‹ï¼šé¦™èœã€çš®è›‹ã€æ¦´æ§¤...)</p>
        
        <div class="canvas-wrapper">
            <canvas id="drawing-board"></canvas>
        </div>

        <div class="paint-tools">
            <div class="color-btn active" style="background:black;" onclick="setColor('black', this)"></div>
            <div class="color-btn" style="background:#e17055;" onclick="setColor('#e17055', this)"></div>
            <div class="color-btn" style="background:#00b894;" onclick="setColor('#00b894', this)"></div>
            <div class="color-btn" style="background:#0984e3;" onclick="setColor('#0984e3', this)"></div>
            <button class="ctrl-btn secondary" onclick="clearCanvas()">ğŸ—‘ï¸ æ¸…é™¤ç•«å¸ƒ</button>
        </div>
    </div>

    <!-- Slide 4: å°è©± (New Avatars) -->
    <div class="slide" id="s4">
        <h2>ğŸ’¬ å¤«å¦»æ¯’èˆŒæ—¥å¸¸</h2>
        <div class="chat-container">
            <!-- Shen Fu -->
            <div class="chat-row shen">
                <div class="avatar-group">
                    <!-- NEW DESIGN Shen Fu (Scholar Style) -->
                    <svg class="avatar-svg" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="48" fill="#f1f2f6"/>
                        <!-- Hat: Gua Pi Mao -->
                        <path d="M20,35 Q50,15 80,35 L80,50 Q50,30 20,50 Z" fill="#2d3436"/>
                        <circle cx="50" cy="25" r="5" fill="#d63031"/>
                        <!-- Face -->
                        <circle cx="50" cy="65" r="28" fill="#ffeaa7"/>
                        <!-- Robe -->
                        <path d="M10,90 Q50,120 90,90 V120 H10 Z" fill="#0984e3"/>
                        <!-- Features -->
                        <circle cx="40" cy="62" r="3" fill="#333"/>
                        <circle cx="60" cy="62" r="3" fill="#333"/>
                        <path d="M45,75 Q50,80 55,75" stroke="#333" fill="none" stroke-width="2"/>
                        <!-- Details -->
                        <rect x="25" y="85" width="50" height="5" fill="#0c2461"/> <!-- Collar -->
                    </svg>
                    <div class="avatar-name">æ²ˆå¾©</div>
                </div>
                <div class="chat-bubble" onclick="nextChatState(this)">
                    <div class="placeholder">...</div>
                    <div class="chat-text">ã€Œç‹—ç„¡èƒƒè€Œé£Ÿç³ï¼Œèœ£è‚åœ˜ç³è€ŒåŒ–èŸ¬ã€‚å¿å…¶ç‹—è€¶ï¼ŸèŸ¬è€¶ï¼Ÿã€</div>
                    <div class="chat-trans">ä½ æ˜¯ç‹—å—ï¼Ÿé‚„æ˜¯å±æ®¼éƒï¼Ÿä¸ç„¶æ€éº¼æœƒåƒé€™ç¨®æ±è¥¿ï¼Ÿ</div>
                </div>
            </div>

            <!-- Yun Niang -->
            <div class="chat-row yun">
                <div class="avatar-group">
                    <!-- NEW DESIGN Yun Niang (Traditional Hair) -->
                    <svg class="avatar-svg" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="48" fill="#fff0f5"/>
                        <!-- Robe -->
                        <path d="M10,95 Q50,120 90,95 V120 H10 Z" fill="#fd79a8"/>
                        <!-- Face -->
                        <circle cx="50" cy="65" r="26" fill="#ffeaa7"/>
                        <!-- Hair (Large Bun) -->
                        <path d="M20,60 Q50,0 80,60" fill="#2d3436"/>
                        <circle cx="15" cy="55" r="10" fill="#2d3436"/>
                        <circle cx="85" cy="55" r="10" fill="#2d3436"/>
                        <!-- Flower -->
                        <circle cx="80" cy="45" r="8" fill="#e056fd"/>
                        <circle cx="80" cy="45" r="3" fill="#ffeaa7"/>
                        <!-- Features -->
                        <circle cx="40" cy="62" r="3" fill="#333"/>
                        <circle cx="60" cy="62" r="3" fill="#333"/>
                        <path d="M45,75 Q50,80 55,75" stroke="#e056fd" fill="none" stroke-width="2"/>
                        <!-- Blush -->
                        <circle cx="35" cy="70" r="4" fill="#fd79a8" opacity="0.4"/>
                        <circle cx="65" cy="70" r="4" fill="#fd79a8" opacity="0.4"/>
                    </svg>
                    <div class="avatar-name">èŠ¸å¨˜</div>
                </div>
                <div class="chat-bubble" onclick="nextChatState(this)">
                    <div class="placeholder">...</div>
                    <div class="chat-text">ã€Œè…ä¸æ•¢å¼·ï¼Œç“œå¯æ‰¼é¼»ç•¥å˜—ã€‚ã€</div>
                    <div class="chat-trans">è‡­è±†è…æˆ‘å°±ä¸å‹‰å¼·ä½ åƒäº†ï¼Œä½†é€™å€‹ç“œä½ æè‘—é¼»å­è©¦è©¦çœ‹å˜›ã€‚</div>
                </div>
            </div>

            <!-- Shen Fu -->
            <div class="chat-row shen">
                <div class="avatar-group">
                     <svg class="avatar-svg" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="48" fill="#f1f2f6"/>
                        <path d="M20,35 Q50,15 80,35 L80,50 Q50,30 20,50 Z" fill="#2d3436"/>
                        <circle cx="50" cy="25" r="5" fill="#d63031"/>
                        <circle cx="50" cy="65" r="28" fill="#ffeaa7"/>
                        <path d="M10,90 Q50,120 90,90 V120 H10 Z" fill="#0984e3"/>
                        <circle cx="40" cy="62" r="3" fill="#333"/> <circle cx="60" cy="62" r="3" fill="#333"/>
                        <path d="M42,75 L58,75" stroke="#333" fill="none" stroke-width="2"/> <!-- Flat mouth -->
                        <rect x="25" y="85" width="50" height="5" fill="#0c2461"/>
                    </svg>
                    <div class="avatar-name">æ²ˆå¾©</div>
                </div>
                <div class="chat-bubble" onclick="nextChatState(this)">
                    <div class="placeholder">...</div>
                    <div class="chat-text">ã€Œå¿é™·æˆ‘ä½œç‹—è€¶ï¼Ÿã€</div>
                    <div class="chat-trans">ä½ é€™æ˜¯è¦é™·å®³æˆ‘ç•¶ç‹—å—ï¼Ÿ</div>
                </div>
            </div>

            <!-- Yun Niang -->
            <div class="chat-row yun">
                <div class="avatar-group">
                    <svg class="avatar-svg" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="48" fill="#fff0f5"/>
                        <path d="M10,95 Q50,120 90,95 V120 H10 Z" fill="#fd79a8"/>
                        <circle cx="50" cy="65" r="26" fill="#ffeaa7"/>
                        <path d="M20,60 Q50,0 80,60" fill="#2d3436"/>
                        <circle cx="15" cy="55" r="10" fill="#2d3436"/>
                        <circle cx="85" cy="55" r="10" fill="#2d3436"/>
                        <circle cx="80" cy="45" r="8" fill="#e056fd"/>
                        <circle cx="80" cy="45" r="3" fill="#ffeaa7"/>
                        <circle cx="40" cy="62" r="3" fill="#333"/> <circle cx="60" cy="62" r="3" fill="#333"/>
                        <path d="M40,75 Q50,85 60,75" stroke="#e056fd" fill="none" stroke-width="2"/> <!-- Big Smile -->
                        <circle cx="35" cy="70" r="4" fill="#fd79a8" opacity="0.4"/>
                        <circle cx="65" cy="70" r="4" fill="#fd79a8" opacity="0.4"/>
                    </svg>
                    <div class="avatar-name">èŠ¸å¨˜</div>
                </div>
                <div class="chat-bubble" onclick="nextChatState(this)">
                    <div class="placeholder">...</div>
                    <div class="chat-text">ã€Œå¦¾ä½œç‹—ä¹…çŸ£ã€‚ã€(ä»¥ç®¸å¼·å¡)</div>
                    <div class="chat-trans">æˆ‘éƒ½ç•¶ç‹—é€™éº¼ä¹…äº†ï¼Œä½ ä¹Ÿä¸€èµ·ç•¶å§ï¼(ç¡¬å¡)</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Slide 5: ä¸‰æ­¥é©Ÿ -->
    <div class="slide" id="s5">
        <h2>ğŸ¤ª çœŸé¦™ä¸‰éƒ¨æ›²</h2>
        <div style="text-align: right; width: 100%; margin-bottom: 20px;">
            <button class="ctrl-btn secondary" onclick="resetSteps()">â†º é‡æ–°é«”é©—</button>
        </div>
        <div class="step-container">
            <div class="step-box" id="step1" onclick="activateStep(1)">
                <div class="step-emoji">âœ‹ğŸ‘ƒ</div>
                <h3>1. æ©é¼»å’€åš¼</h3>
                <p>æè‘—é¼»å­åƒ</p>
            </div>
            <div class="step-box" id="step2" onclick="activateStep(2)">
                <div class="step-emoji">ğŸ‘ƒâœ¨</div>
                <h3>2. é–‹é¼»å†åš¼</h3>
                <p>å¥½åƒä¸éŒ¯ï¼Ÿ</p>
            </div>
            <div class="step-box" id="step3" onclick="activateStep(3)">
                <div class="step-emoji">ğŸ¤¤â¤ï¸</div>
                <h3>3. ç«Ÿæˆç•°å‘³</h3>
                <p>å¤ªå¥½åƒäº†ï¼</p>
            </div>
        </div>
        <div id="step-success-msg">ğŸ‰ æŒ‘æˆ°æˆåŠŸï¼šæ²ˆå¾©å·²ç¶“æ„›ä¸Šè‡­è±†è…äº†ï¼</div>
    </div>

    <!-- Slide 6: ç‰¹è³ªåˆ†é¡ -->
    <div class="slide" id="s6">
        <h2>ğŸ§  å¤«å¦»é»˜å¥‘å¤§è€ƒé©—</h2>
        <div style="display:flex; justify-content:space-between; width:100%; align-items:center; margin-bottom:10px;">
            <p style="margin:0;">è«‹å°‡ã€Œç‰¹è³ªæœ¨ç‰Œã€æ‹–æ›³(æˆ–é»æ“Š)åˆ†é¡ï¼</p>
            <button class="ctrl-btn secondary" onclick="initSortGame()">â†º é‡æ–°æŒ‘æˆ°</button>
        </div>
        
        <div class="sort-game-container">
            <button id="check-btn" onclick="checkAnswers()">å®Œæˆä½œç­” âœ…</button>

            <!-- å€åŸŸï¼šæ²ˆå¾© -->
            <div class="zone shen" id="zone-shen" onclick="zoneClick('shen')">
                <svg width="100" height="100" viewBox="0 0 100 100">
                     <circle cx="50" cy="50" r="48" fill="#f1f2f6"/>
                    <path d="M20,35 Q50,15 80,35 L80,50 Q50,30 20,50 Z" fill="#2d3436"/>
                    <circle cx="50" cy="25" r="5" fill="#d63031"/>
                    <circle cx="50" cy="65" r="28" fill="#ffeaa7"/>
                    <path d="M10,90 Q50,120 90,90 V120 H10 Z" fill="#0984e3"/>
                    <circle cx="40" cy="62" r="3" fill="#333"/> <circle cx="60" cy="62" r="3" fill="#333"/>
                    <path d="M45,75 Q50,80 55,75" stroke="#333" fill="none" stroke-width="2"/>
                </svg>
                <h3>æ²ˆå¾©</h3>
                <div class="zone-content" id="content-shen"></div>
            </div>
            
            <!-- å€åŸŸï¼šèŠ¸å¨˜ -->
            <div class="zone yun" id="zone-yun" onclick="zoneClick('yun')">
                <svg width="100" height="100" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="48" fill="#fff0f5"/>
                    <path d="M10,95 Q50,120 90,95 V120 H10 Z" fill="#fd79a8"/>
                    <circle cx="50" cy="65" r="26" fill="#ffeaa7"/>
                    <path d="M20,60 Q50,0 80,60" fill="#2d3436"/>
                    <circle cx="15" cy="55" r="10" fill="#2d3436"/>
                    <circle cx="85" cy="55" r="10" fill="#2d3436"/>
                    <circle cx="80" cy="45" r="8" fill="#e056fd"/>
                    <circle cx="80" cy="45" r="3" fill="#ffeaa7"/>
                    <circle cx="40" cy="62" r="3" fill="#333"/> <circle cx="60" cy="62" r="3" fill="#333"/>
                    <path d="M45,75 Q50,80 55,75" stroke="#e056fd" fill="none" stroke-width="2"/>
                </svg>
                <h3>èŠ¸å¨˜</h3>
                <div class="zone-content" id="content-yun"></div>
            </div>
            
            <!-- å¾…é¸ç‰Œå¡å€ -->
            <div class="deck-area" id="deck"></div>
        </div>
    </div>

    <!-- Slide 7: é‡é»æ•´ç† -->
    <div class="slide" id="s7">
        <h2>ğŸ“š èª²ç¨‹é‡é»æ•´ç†</h2>
        <div class="summary-card">
            <div class="summary-title">äººç‰©æ€§æ ¼å°æ¯”</div>
            <ul class="summary-list">
                <li><span class="highlight-text">æ²ˆå¾©</span>ï¼šä¿å®ˆã€æ‹˜è¬¹ï¼Œä½†ä¹Ÿé¡˜æ„ç‚ºäº†æ„›å˜—è©¦æ–°äº‹ç‰©ã€‚</li>
                <li><span class="highlight-text">èŠ¸å¨˜</span>ï¼šæ´»æ½‘ã€å¼·å‹¢ã€èª¿çš®ï¼Œæ‡‚å¾—ç”Ÿæ´»æƒ…è¶£ï¼ˆå¯©ç¾çœ¼å…‰ç¨ç‰¹ï¼‰ã€‚</li>
            </ul>
            <br>
            <div class="summary-title">æ–‡ç« ä¸»æ—¨èˆ‡ç‰¹è‰²</div>
            <ul class="summary-list">
                <li>é€™ä¸æ˜¯ä¸€ç¯‡åš´è‚…çš„è­°è«–æ–‡ï¼Œè€Œæ˜¯å……æ»¿ç”Ÿæ´»æ°£æ¯çš„<span class="highlight-text">ã€Œè¨˜æ•˜æ–‡ã€</span>ã€‚</li>
                <li>é€éåƒè‡­è±†è…é€™ä»¶å°äº‹ï¼Œå±•ç¾å¤«å¦»é–“<span class="highlight-text">ã€Œé–¨æˆ¿è¨˜æ¨‚ã€</span>çš„ç”œèœœäº’å‹•ã€‚</li>
                <li>å–„ç”¨å°è©±èˆ‡å‹•ä½œæå¯«ï¼ˆå¦‚ï¼šæ©é¼»ã€å¼·å¡ï¼‰ï¼Œè®“äººç‰©å½¢è±¡æ ©æ ©å¦‚ç”Ÿã€‚</li>
            </ul>
        </div>
        <button class="ctrl-btn primary" style="margin-top: 40px; font-size: 2rem; padding: 20px 60px;" onclick="finishClass()">ğŸ‰ ä¸‹èª²å›‰ï¼</button>
    </div>

    <!-- æ¨¡æ…‹æ¡† (å…±ç”¨) -->
    <div class="modal-overlay" id="result-modal">
        <div class="modal-box">
            <h2 id="modal-title"></h2>
            <p id="modal-msg" style="font-size:1.5rem; line-height:1.6;"></p>
            <button class="ctrl-btn secondary" style="margin-top:20px;" onclick="closeModal()">ç¢ºå®š</button>
        </div>
    </div>

    <!-- å½±ç‰‡æ¨¡æ…‹æ¡† (æ–°å¢) -->
    <div class="modal-overlay" id="video-modal">
        <div class="modal-box">
            <button class="ctrl-btn secondary" style="position:absolute; top:10px; right:10px; background:none; color:#333; border:none; font-size:1.5rem;" onclick="closeVideoModal()">âœ•</button>
            <div class="video-container">
                <iframe src="https://www.youtube.com/embed/LJBFTKDcISE" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="nav-controls">
        <div class="nav-btn disabled" id="btn-prev" onclick="move(-1)">â®</div>
        <div style="flex:1"></div>
        <div class="nav-btn" id="btn-next" onclick="move(1)">â¯</div>
    </div>
</div>

<script>
    // === æ ¸å¿ƒå°èˆª ===
    let currentSlide = 0;
    const slides = document.querySelectorAll('.slide');
    const btnPrev = document.getElementById('btn-prev');
    const btnNext = document.getElementById('btn-next');

    function move(dir) {
        let nextIndex = currentSlide + dir;
        if (nextIndex < 0 || nextIndex >= slides.length) return;
        slides[currentSlide].classList.remove('active');
        currentSlide = nextIndex;
        slides[currentSlide].classList.add('active');
        updateNav();
        
        // Canvas Resize
        if(currentSlide === 2) setTimeout(resizeCanvas, 100);
        // Game Init
        if(currentSlide === 5) initSortGame();
    }

    function updateNav() {
        if(currentSlide === 0) {
            btnPrev.classList.add('disabled');
        } else {
            btnPrev.classList.remove('disabled');
        }

        if(currentSlide === slides.length - 1) {
             btnNext.style.display = 'none'; // æœ€å¾Œä¸€é éš±è—ä¸‹ä¸€é 
        } else {
             btnNext.style.display = 'flex';
             btnNext.innerHTML = "â¯";
        }
    }

    // === Slide 2: ç¿»é é‚è¼¯ & å½±ç‰‡ ===
    let textPage = 1;
    function changePage(n) {
        const pages = document.querySelectorAll('.text-page');
        const prevBtn = document.getElementById('prev-page');
        const nextBtn = document.getElementById('next-page');
        
        // èˆŠé é¢é›¢é–‹å‹•ç•«
        pages[textPage-1].classList.remove('active');
        pages[textPage-1].classList.add('leaving');
        
        setTimeout(() => {
             pages.forEach(p => p.classList.remove('leaving')); // æ¸…ç†
        }, 800);

        textPage += n;
        
        if(textPage < 1) textPage = 1;
        if(textPage > 2) textPage = 2;
        
        // æ–°é é¢é€²å ´å‹•ç•«
        pages[textPage-1].classList.add('active');
        document.getElementById('page-num').innerText = `${textPage} / 2`;
        
        prevBtn.disabled = (textPage === 1);
        nextBtn.disabled = (textPage === 2);
    }

    function openVideoModal() { document.getElementById('video-modal').style.display = 'flex'; }
    function closeVideoModal() { document.getElementById('video-modal').style.display = 'none'; }

    // === Slide 3: ç•«å¸ƒ ===
    const canvas = document.getElementById('drawing-board');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;
    
    function resizeCanvas() {
        const parent = canvas.parentElement;
        canvas.width = parent.clientWidth;
        canvas.height = parent.clientHeight;
        ctx.lineCap = 'round'; ctx.lineJoin = 'round'; ctx.lineWidth = 6; ctx.strokeStyle = 'black';
    }

    function getPos(e) {
        const rect = canvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        return { x: clientX - rect.left, y: clientY - rect.top };
    }

    function startDraw(e) {
        e.preventDefault();
        isDrawing = true;
        const pos = getPos(e);
        ctx.beginPath();
        ctx.moveTo(pos.x, pos.y);
    }
    
    function draw(e) {
        if (!isDrawing) return;
        e.preventDefault();
        const pos = getPos(e);
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
    }
    
    function stopDraw(e) {
        if(isDrawing) { isDrawing = false; ctx.closePath(); }
    }
    
    canvas.addEventListener('mousedown', startDraw);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDraw);
    canvas.addEventListener('touchstart', startDraw, {passive: false});
    canvas.addEventListener('touchmove', draw, {passive: false});
    canvas.addEventListener('touchend', stopDraw);

    function clearCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); }
    function setColor(color, btn) {
        ctx.strokeStyle = color;
        document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    // === Slide 4: èŠå¤©äº’å‹• ===
    function nextChatState(el) {
        const placeholder = el.querySelector('.placeholder');
        const text = el.querySelector('.chat-text');
        const trans = el.querySelector('.chat-trans');
        
        if(placeholder.style.display !== 'none') {
            placeholder.style.display = 'none';
            text.style.display = 'block';
            setTimeout(() => text.style.opacity = 1, 10);
        } else if(trans.style.display !== 'block') {
            trans.style.display = 'block';
            setTimeout(() => trans.style.opacity = 1, 10);
        }
    }

    // === Slide 5: ä¸‰æ­¥é©Ÿ ===
    function activateStep(n) {
        for(let i=1; i<=n; i++) {
            let el = document.getElementById(`step${i}`);
            if(el) el.classList.add('active');
        }
        if (n === 3) {
            document.getElementById('step-success-msg').style.opacity = 1;
            document.getElementById('step-success-msg').style.transform = "translateX(-50%) scale(1.1)";
            document.getElementById('s5').style.backgroundColor = "#dff9fb";
        }
    }

    function resetSteps() {
        document.querySelectorAll('.step-box').forEach(b => b.classList.remove('active'));
        document.getElementById('step-success-msg').style.opacity = 0;
        document.getElementById('step-success-msg').style.transform = "translateX(-50%) scale(0.9)";
        document.getElementById('s5').style.backgroundColor = "";
    }

    // === Slide 6: ç‰¹è³ªåˆ†é¡ (å«é‡ç½®) ===
    const traits = [
        { id: 1, txt: "å–œé£Ÿè’œ", target: "shen" },
        { id: 2, txt: "å–œé£Ÿè‡­è±†è…", target: "yun" },
        { id: 3, txt: "æœ€è¨å­è¦é¹µç“œ", target: "shen" },
        { id: 4, txt: "å¼·äººæ‰€é›£", target: "yun" },
        { id: 5, txt: "å‹‡æ–¼å˜—è©¦", target: "shen" },
        { id: 6, txt: "è‡ªèªç‚ºç‹—", target: "yun" }
    ];
    let selectedCard = null;

    function initSortGame() {
        const deck = document.getElementById('deck');
        document.getElementById('content-shen').innerHTML = '';
        document.getElementById('content-yun').innerHTML = '';
        document.getElementById('check-btn').style.display = 'none';
        deck.innerHTML = ''; // æ¸…ç©ºé‡æ–°ç”Ÿæˆ

        traits.forEach((t) => {
            let card = document.createElement('div');
            card.className = 'trait-card';
            card.innerText = t.txt;
            card.dataset.target = t.target;
            card.onclick = (e) => selectCardClick(e, card);
            setupDrag(card);
            deck.appendChild(card);
        });
    }

    function setupDrag(el) {
        let offsetX, offsetY, startX, startY;
        let isDragging = false;

        const startDrag = (e) => {
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            startX = clientX; startY = clientY;
            
            const rect = el.getBoundingClientRect();
            offsetX = clientX - rect.left;
            offsetY = clientY - rect.top;
            
            isDragging = false;

            const onMove = (mv) => {
                const mx = mv.touches ? mv.touches[0].clientX : mv.clientX;
                const my = mv.touches ? mv.touches[0].clientY : mv.clientY;
                
                if (!isDragging && (Math.abs(mx - startX) > 5 || Math.abs(my - startY) > 5)) {
                    isDragging = true;
                    el.style.position = 'fixed'; el.style.zIndex = 1000; el.style.width = rect.width + 'px';
                    if(selectedCard) { selectedCard.classList.remove('selected'); selectedCard = null; }
                }

                if (isDragging) {
                    mv.preventDefault();
                    el.style.left = (mx - offsetX) + 'px'; el.style.top = (my - offsetY) + 'px';
                    checkHover(mx, my);
                }
            };

            const onEnd = (end) => {
                document.removeEventListener('mousemove', onMove); document.removeEventListener('touchmove', onMove);
                document.removeEventListener('mouseup', onEnd); document.removeEventListener('touchend', onEnd);

                if (isDragging) {
                    el.style.zIndex = '';
                    const endRect = el.getBoundingClientRect();
                    const cx = endRect.left + endRect.width/2; const cy = endRect.top + endRect.height/2;
                    let dropped = false;

                    document.querySelectorAll('.zone').forEach(z => {
                        z.classList.remove('hover');
                        const zr = z.getBoundingClientRect();
                        if(cx > zr.left && cx < zr.right && cy > zr.top && cy < zr.bottom) {
                            z.querySelector('.zone-content').appendChild(el);
                            el.style.position = 'static'; el.style.left = ''; el.style.top = ''; el.style.width = '';
                            dropped = true;
                        }
                    });

                    if(!dropped) {
                        document.getElementById('deck').appendChild(el);
                        el.style.position = 'static'; el.style.left = ''; el.style.top = ''; el.style.width = '';
                    }
                    checkCompletion();
                }
            };
            document.addEventListener('mousemove', onMove); document.addEventListener('touchmove', onMove, {passive: false});
            document.addEventListener('mouseup', onEnd); document.addEventListener('touchend', onEnd);
        };
        el.addEventListener('mousedown', startDrag); el.addEventListener('touchstart', startDrag, {passive: false});
    }

    function checkHover(x, y) {
        document.querySelectorAll('.zone').forEach(z => {
            const r = z.getBoundingClientRect();
            if(x > r.left && x < r.right && y > r.top && y < r.bottom) z.classList.add('hover');
            else z.classList.remove('hover');
        });
    }

    function selectCardClick(e, card) {
        if(card.style.position === 'fixed') return; 
        e.stopPropagation();
        if(selectedCard === card) { selectedCard.classList.remove('selected'); selectedCard = null; }
        else {
            if(selectedCard) selectedCard.classList.remove('selected');
            selectedCard = card; card.classList.add('selected');
        }
    }

    function zoneClick(target) {
        if(selectedCard) {
            const zone = document.getElementById(`content-${target}`);
            zone.appendChild(selectedCard);
            selectedCard.classList.remove('selected'); selectedCard = null;
            checkCompletion();
        }
    }

    function checkCompletion() {
        const deck = document.getElementById('deck');
        document.getElementById('check-btn').style.display = (deck.children.length === 0) ? 'block' : 'none';
    }

    function checkAnswers() {
        const shenCards = Array.from(document.getElementById('content-shen').children);
        const yunCards = Array.from(document.getElementById('content-yun').children);
        let allCorrect = true;

        shenCards.forEach(c => {
            if(c.dataset.target !== 'shen') { allCorrect = false; c.classList.add('wrong'); }
            else c.classList.add('correct');
        });
        yunCards.forEach(c => {
            if(c.dataset.target !== 'yun') { allCorrect = false; c.classList.add('wrong'); }
            else c.classList.add('correct');
        });

        const modal = document.getElementById('result-modal');
        const title = document.getElementById('modal-title');
        const msg = document.getElementById('modal-msg');
        modal.style.display = 'flex';

        if(allCorrect) {
            title.innerText = "ğŸ‰ æŒ‘æˆ°æˆåŠŸï¼"; title.style.color = "#00b894";
            msg.innerHTML = "æ²ˆå¾©ï¼šè¨å­æ€ªå‘³ä½†é¡˜æ„å˜—è©¦ã€‚<br>èŠ¸å¨˜ï¼šå€‹æ€§å¼·å‹¢åˆèª¿çš®ï¼Œæ„›åƒè‡­è±†è…ã€‚";
            document.getElementById('check-btn').style.display = 'none';
        } else {
            title.innerText = "âŒ å“å‘€ï¼Œæœ‰éŒ¯èª¤å–”ï¼"; title.style.color = "#d63031";
            msg.innerText = "ç´…è‰²çš„æœ¨ç‰Œæ”¾éŒ¯äº†ï¼Œå†è©¦ä¸€æ¬¡çœ‹çœ‹ï¼Ÿ";
            
            window.resetWrongCards = () => {
                document.querySelectorAll('.trait-card.wrong').forEach(c => {
                    c.classList.remove('wrong'); document.getElementById('deck').appendChild(c);
                });
                document.getElementById('check-btn').style.display = 'none';
            };
        }
    }

    function closeModal() {
        document.getElementById('result-modal').style.display = 'none';
        if(window.resetWrongCards) { window.resetWrongCards(); window.resetWrongCards = null; }
    }

    function finishClass() {
        alert("èª²ç¨‹çµæŸï¼å„ä½åŒå­¸è¾›è‹¦äº†ï¼è¨˜å¾—å›å®¶ä¸è¦äº‚é€¼åˆ¥äººåƒæ±è¥¿å–” (èª¤)");
    }
</script>
</body>
</html>
