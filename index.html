<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¬¬å…«ç¯€è¼”å°èª²ï¼šæ²ˆå¾©èˆ‡èŠ¸å¨˜çš„ç”œèœœæˆ°çˆ­</title>
    <style>
        :root {
            /* æƒ…ä¾¶é¢¨æ ¼é…è‰² */
            --primary: #fd79a8; /* æˆ€æ„›ç²‰ */
            --primary-dark: #e84393;
            --secondary: #74b9ff; /* ç”·å‹è— */
            --accent: #ffeaa7; /* æº«é¦¨é»ƒ */
            --text: #2d3436;
            --bg: #fff0f5; 
            --card-bg: rgba(255, 255, 255, 0.98);
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
        }

        body {
            font-family: "Microsoft JhengHei", "PingFang TC", serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg);
            background-image: 
                radial-gradient(circle, var(--primary) 2px, transparent 2.5px),
                radial-gradient(circle, var(--primary) 2px, transparent 2.5px);
            background-size: 40px 40px;
            background-position: 0 0, 20px 20px;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            color: var(--text);
        }

        /* 1920x1080 å®¹å™¨ */
        .slide-container {
            width: 1920px;
            height: 1080px;
            max-width: 100vw;
            max-height: 100vh;
            aspect-ratio: 16 / 9;
            background: var(--card-bg);
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(253, 121, 168, 0.3);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 8px solid white;
        }

        /* è£é£¾æ¡†ç·š */
        .slide-container::after {
            content: "";
            position: absolute;
            top: 20px; left: 20px; right: 20px; bottom: 20px;
            border: 3px dashed var(--primary);
            border-radius: 20px;
            pointer-events: none;
            opacity: 0.5;
            z-index: 0;
        }

        .slide {
            display: none;
            flex: 1;
            padding: 20px 60px;
            flex-direction: column;
            align-items: center;
            animation: fadeIn 0.6s cubic-bezier(0.22, 1, 0.36, 1);
            height: 100%;
            overflow-y: auto;
            position: relative;
            z-index: 1;
        }

        .slide.active { display: flex; }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        h1 { font-size: 3.5rem; margin: 10px 0; color: var(--primary-dark); text-shadow: 2px 2px 0px white; letter-spacing: 5px; text-align: center; }
        h2 { font-size: 2rem; margin-bottom: 15px; color: #636e72; background: linear-gradient(to top, var(--accent) 40%, transparent 40%); padding: 0 10px; border-radius: 5px; }

        /* å°èˆªæŒ‰éˆ• */
        .nav-controls {
            position: absolute;
            bottom: 30px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            padding: 0 50px;
            pointer-events: none;
            z-index: 50;
        }

        .nav-btn {
            pointer-events: auto;
            background: white;
            color: var(--primary);
            border: 3px solid var(--primary);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .nav-btn:hover { background: var(--primary); color: white; transform: scale(1.1); }
        .nav-btn.disabled { opacity: 0.3; cursor: not-allowed; filter: grayscale(1); }

        /* Slide 1: å°é¢è¨­è¨ˆ (SVG) */
        .hero-visual { margin: 30px; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% {transform: translateY(0);} 50% {transform: translateY(-15px);} }

        /* Slide 2: åŸæ–‡æ”¹ç‚ºä¸Šä¸‹é…ç½® (èª¿æ•´æ¯”ä¾‹) */
        .text-layout-v {
            display: flex;
            flex-direction: column;
            width: 90%;
            height: 85%;
            gap: 15px;
        }
        .text-paper-v {
            flex: 4; /* å¢åŠ åŸæ–‡å€å¡Šä½”æ¯” */
            background: white;
            padding: 25px 40px;
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            font-size: 1.9rem;
            line-height: 1.8;
            text-align: justify;
            font-family: "KaiTi", "BiauKai", serif;
            border-left: 8px solid var(--primary);
            overflow-y: auto;
        }
        .note-panel-v {
            flex: 1.5; /* ç¸®å°è¨»é‡‹å€å¡Šä½”æ¯” */
            background: #fffdf0;
            border: 2px dashed #b2bec3;
            border-radius: 20px;
            padding: 15px 25px;
            overflow-y: auto;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-content: center;
        }
        .note-item {
            font-size: 1.3rem;
            background: white;
            padding: 5px 12px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border: 1px solid #dfe6e9;
        }
        .note-key { color: var(--primary-dark); font-weight: bold; margin-right: 5px; }
        .highlight { background-color: var(--accent); padding: 0 5px; border-radius: 5px; cursor: help; }

        /* Slide 3: ç•«å¸ƒ (ä½ ç•«æˆ‘çŒœ) */
        .canvas-wrapper {
            width: 800px;
            height: 450px;
            background: white;
            border: 5px dashed var(--secondary);
            border-radius: 20px;
            position: relative;
            cursor: crosshair;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
        }
        .paint-tools { display: flex; gap: 20px; margin-top: 20px; }
        .color-btn { width: 50px; height: 50px; border-radius: 50%; border: 4px solid white; box-shadow: 0 5px 10px rgba(0,0,0,0.2); cursor: pointer; transition: 0.2s; }
        .color-btn.active { transform: scale(1.2); border-color: var(--text); }
        .ctrl-btn { 
            font-size: 1.2rem; padding: 10px 25px; cursor: pointer; border: none; 
            background: var(--primary); color: white; border-radius: 50px; 
            font-weight: bold; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin: 0 10px;
        }
        .ctrl-btn.secondary { background: #b2bec3; }

        /* Slide 4: å°è©± (æ›´æ–°äº’å‹•) */
        .chat-container {
            width: 85%; background: rgba(255,255,255,0.7); border-radius: 20px;
            padding: 30px; flex: 1; display: flex; flex-direction: column; gap: 20px;
            overflow-y: auto; margin-bottom: 20px;
        }
        .chat-row {
            display: flex; gap: 20px; max-width: 85%; align-items: flex-end;
        }
        .chat-row.shen { align-self: flex-start; }
        .chat-row.yun { align-self: flex-end; flex-direction: row-reverse; }

        .avatar-svg { width: 70px; height: 70px; min-width: 70px; filter: drop-shadow(0 3px 3px rgba(0,0,0,0.1)); }

        .chat-bubble {
            padding: 15px 25px; border-radius: 20px; font-size: 1.7rem;
            position: relative; cursor: pointer; box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            background: white; border: 2px solid #dfe6e9; min-height: 60px; display: flex; flex-direction: column; justify-content: center;
            transition: 0.3s;
        }
        .chat-bubble:active { transform: scale(0.98); }
        .chat-row.yun .chat-bubble { background: #ffdde1; border-color: #ffdde1; }

        /* éš±è—/é¡¯ç¤ºé‚è¼¯ */
        .chat-text { opacity: 0; transition: 0.5s; font-family: "KaiTi", serif; font-weight: bold; display: none; }
        .chat-trans { opacity: 0; transition: 0.5s; font-size: 1.3rem; color: #d63031; margin-top: 5px; border-top: 1px dashed rgba(0,0,0,0.2); padding-top: 5px; display: none; }
        .placeholder { color: #b2bec3; font-size: 2rem; font-weight: bold; letter-spacing: 5px; }

        /* Slide 6: ç‰¹è³ªåˆ†é¡ (æ›´æ–°æ‹–æ›³èˆ‡æŒ‰éˆ•) */
        .sort-game-container {
            display: flex; width: 100%; height: 75%; gap: 30px; position: relative;
        }
        .zone {
            flex: 1; border-radius: 20px; display: flex; flex-direction: column; align-items: center; padding: 20px;
            transition: 0.3s; border: 4px dashed rgba(0,0,0,0.1); background: rgba(255,255,255,0.6);
            position: relative;
        }
        .zone.hover { background: rgba(253, 121, 168, 0.1); border-color: var(--primary); transform: scale(1.02); }
        .zone h3 { font-size: 2rem; margin: 10px 0 20px 0; }
        .zone-content { width: 100%; flex: 1; display: flex; flex-wrap: wrap; align-content: flex-start; gap: 10px; justify-content: center; padding-top: 10px; }
        
        .deck-area {
            position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
            width: 70%; height: 100px; background: white; border-radius: 20px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1); padding: 10px; display: flex; justify-content: center; gap: 15px; align-items: center;
            z-index: 10;
        }

        .trait-card {
            background: var(--text); color: white; padding: 12px 20px; border-radius: 10px;
            font-size: 1.4rem; cursor: grab; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: transform 0.1s; touch-action: none; /* é‡è¦ï¼šé˜²æ­¢è§¸æ§æ²å‹• */
            position: relative; z-index: 100;
        }
        .trait-card:active { cursor: grabbing; transform: scale(1.1); }
        .trait-card.correct { background: var(--secondary); pointer-events: none; }
        .trait-card.wrong { background: #d63031; animation: shake 0.4s; }

        @keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-5px);} 75% {transform: translateX(5px);} }

        /* å®ŒæˆæŒ‰éˆ• */
        #check-btn {
            position: absolute; top: -60px; right: 0;
            padding: 15px 30px; font-size: 1.5rem; background: var(--secondary); color: white;
            border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: none; z-index: 200;
        }
        #check-btn:hover { transform: scale(1.1); }

        /* çµæœæ¨¡æ…‹æ¡† */
        .modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 999;
        }
        .modal-box {
            background: white; padding: 40px; border-radius: 30px; text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3); max-width: 500px;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    </style>
</head>
<body>

<div class="slide-container">
    
    <!-- Slide 1: å°é¢ -->
    <div class="slide active" id="s1">
        <div style="flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center;">
            <h1>æ²ˆå¾©èˆ‡èŠ¸å¨˜çš„ç”œèœœæˆ°çˆ­</h1>
            <h2>ã€Šæµ®ç”Ÿå…­è¨˜ãƒ»é–¨æˆ¿è¨˜æ¨‚ã€‹</h2>
            
            <!-- ä¸»è¦–è¦ºï¼šæ„›å¿ƒé£¯ç¢— SVG -->
            <div class="hero-visual">
                <svg width="250" height="250" viewBox="0 0 200 200">
                    <path d="M100,60 Q120,30 140,60 T140,100 Q100,140 100,140 Q60,100 60,60 T100,60" fill="#fd79a8" opacity="0.6">
                        <animate attributeName="transform" type="translate" values="0,0; 0,-10; 0,0" dur="3s" repeatCount="indefinite"/>
                        <animate attributeName="opacity" values="0.6; 0.3; 0.6" dur="3s" repeatCount="indefinite"/>
                    </path>
                    <path d="M20,130 Q100,210 180,130 L180,120 L20,120 Z" fill="#74b9ff" stroke="#2d3436" stroke-width="4"/>
                    <line x1="50" y1="20" x2="130" y2="130" stroke="#fab1a0" stroke-width="8" stroke-linecap="round"/>
                    <line x1="70" y1="20" x2="150" y2="130" stroke="#fab1a0" stroke-width="8" stroke-linecap="round"/>
                </svg>
            </div>

            <p>ã€ä»Šæ—¥ä¸»é¡Œã€‘ç•¶ã€ŒæŒ‘é£Ÿè€å…¬ã€é‡ä¸Šã€Œå¼·å‹¢è€å©†ã€...</p>
            <button class="ctrl-btn" style="margin-top:30px; font-size:1.5rem; padding:15px 40px;" onclick="move(1)">é–‹å§‹ä¸Šèª² â–¶</button>
        </div>
    </div>

    <!-- Slide 2: åŸæ–‡ (èª¿æ•´ç‰ˆé¢) -->
    <div class="slide" id="s2">
        <h2>ğŸ“œ åŸæ–‡å°ç…§èˆ‡è¨»é‡‹</h2>
        <div class="text-layout-v">
            <div class="text-paper-v">
                <p>
                    ä½™å–œé£Ÿè’œï¼ŒèŠ¸å–œé£Ÿ<span class="highlight">è…ä¹³</span>ã€‚ä¸”å¥½é£Ÿ<span class="highlight">è¦é¹µç“œ</span>ã€‚äºŒç‰©çš†ä½™æ‰€æƒ¡ã€‚<br>
                    ä½™æˆ²ä¹‹æ›°ï¼šã€Œç‹—ç„¡èƒƒè€Œé£Ÿç³ï¼Œç„¡ä¹ƒ<span class="highlight">æ€ªç‰¹</span>è€Œåœ–ç³ï¼Ÿã€<br>
                    èŠ¸æ›°ï¼šã€Œè…å–å…¶åƒ¹å»‰è€Œå¯ç²¥å¯é£¯ï¼›<span class="highlight">é¹µç“œ</span>ä¹‹å‘³ï¼Œåˆ°å£å‰‡é¬†ï¼Œæ—¢è¾›ä¸”è¾£ã€‚ã€<br>
                    ä½™æ›°ï¼šã€Œç„¶å‰‡æˆ‘å®¶ä¿‚<span class="highlight">ç‹—ç«‡</span>è€¶ï¼Ÿã€<br>
                    èŠ¸æ›°ï¼šã€Œ...å¦¾ä½œç‹—ä¹…çŸ£ï¼Œå±ˆå›è©¦å˜—ä¹‹ã€‚ã€ä¹ƒ<span class="highlight">ä»¥ç®¸å¼·å¡</span>ä½™å£ã€‚<br>
                    ä½™<span class="highlight">æ©é¼»</span>å’€åš¼ä¹‹ï¼Œä¼¼è¦ºè„†ç¾ï¼Œé–‹é¼»å†åš¼ï¼Œç«Ÿæˆç•°å‘³ï¼Œå¾æ­¤äº¦å–œé£Ÿã€‚
                </p>
            </div>
            <div class="note-panel-v">
                <div class="note-item"><span class="note-key">è…ä¹³ï¼š</span>ç™¼é…µè±†è…ã€‚</div>
                <div class="note-item"><span class="note-key">è¦é¹µç“œï¼š</span>è¦é†¬é†ƒé»ƒç“œã€‚</div>
                <div class="note-item"><span class="note-key">ç‹—ç«‡ï¼š</span>ç‹—æ´ã€‚</div>
                <div class="note-item"><span class="note-key">ä»¥ç®¸å¼·å¡ï¼š</span>ç”¨ç­·å­ç¡¬å¡ã€‚</div>
                <div class="note-item"><span class="note-key">æ©é¼»ï¼š</span>æè‘—é¼»å­ã€‚</div>
                <div class="note-item"><span class="note-key">æ€ªç‰¹ï¼š</span>æ€ªç•°ç‰¹åˆ¥ã€‚</div>
            </div>
        </div>
    </div>

    <!-- Slide 3: ä½ ç•«æˆ‘çŒœ (æ–°æ´»å‹•) -->
    <div class="slide" id="s3">
        <h2>ğŸ¨ æ„›çš„å¤§å†’éšªï¼šä½ ç•«æˆ‘çŒœ</h2>
        <p>è«‹ç•«å‡ºï¼šã€Œå–œæ­¡è·Ÿè¨å­å¾ˆå…©æ¥µçš„é£Ÿç‰©ã€(ä¾‹ï¼šé¦™èœã€æ¦´æ§¤...)</p>
        
        <div class="canvas-wrapper">
            <canvas id="drawing-board"></canvas>
        </div>

        <div class="paint-tools">
            <div class="color-btn active" style="background:black;" onclick="setColor('black', this)"></div>
            <div class="color-btn" style="background:#fd79a8;" onclick="setColor('#fd79a8', this)"></div>
            <div class="color-btn" style="background:#74b9ff;" onclick="setColor('#74b9ff', this)"></div>
            <div class="color-btn" style="background:#00b894;" onclick="setColor('#00b894', this)"></div>
            <button class="ctrl-btn secondary" onclick="clearCanvas()">ğŸ—‘ï¸ æ¸…é™¤</button>
        </div>
    </div>

    <!-- Slide 4: å¤«å¦»æ¯’èˆŒæ—¥å¸¸ (æ›´æ–°) -->
    <div class="slide" id="s4">
        <h2>ğŸ’¬ å¤«å¦»æ¯’èˆŒæ—¥å¸¸</h2>
        <div class="chat-container">
            <!-- Shen Fu Row -->
            <div class="chat-row shen">
                <!-- Shen Fu Avatar SVG -->
                <svg class="avatar-svg" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="45" fill="#f1f2f6" stroke="#2d3436" stroke-width="2"/>
                    <rect x="25" y="10" width="50" height="30" fill="#2d3436" rx="5"/> <!-- Hat -->
                    <circle cx="35" cy="55" r="3" fill="#333"/> <circle cx="65" cy="55" r="3" fill="#333"/> <!-- Eyes -->
                    <path d="M40,70 Q50,80 60,70" stroke="#333" stroke-width="2" fill="none"/> <!-- Mouth -->
                </svg>
                <div class="chat-bubble" onclick="nextChatState(this)">
                    <div class="placeholder">...</div>
                    <div class="chat-text">ã€Œç‹—ç„¡èƒƒè€Œé£Ÿç³ï¼Œç„¡ä¹ƒæ€ªç‰¹è€Œåœ–ç³ï¼Ÿã€</div>
                    <div class="chat-trans">ä½ æ˜¯ç‹—å—ï¼Ÿç‹—æ²’èƒƒå£æ‰åƒå±ï¼Œä½ è©²ä¸æœƒæ˜¯ç‚ºäº†ææ€ªæ‰åƒå±å§ï¼Ÿ</div>
                </div>
            </div>

            <!-- Yun Niang Row -->
            <div class="chat-row yun">
                <!-- Yun Niang Avatar SVG -->
                <svg class="avatar-svg" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="45" fill="#fff0f5" stroke="#fd79a8" stroke-width="2"/>
                    <circle cx="20" cy="40" r="15" fill="#2d3436"/> <circle cx="80" cy="40" r="15" fill="#2d3436"/> <!-- Bun -->
                    <path d="M20,40 Q50,-10 80,40" fill="#2d3436"/> <!-- Hair -->
                    <circle cx="35" cy="60" r="3" fill="#333"/> <circle cx="65" cy="60" r="3" fill="#333"/>
                    <path d="M40,75 Q50,85 60,75" stroke="#fd79a8" stroke-width="2" fill="none"/>
                    <rect x="75" y="30" width="20" height="4" fill="#fd79a8" transform="rotate(-20)"/> <!-- Hairpin -->
                </svg>
                <div class="chat-bubble" onclick="nextChatState(this)">
                    <div class="placeholder">...</div>
                    <div class="chat-text">ã€Œè…å–å…¶åƒ¹å»‰è€Œå¯ç²¥å¯é£¯...ã€</div>
                    <div class="chat-trans">è‡­è±†è…ä¾¿å®œåˆä¸‹é£¯ï¼›è¦é¹µç“œå£æ„Ÿè„†åˆè¾£ï¼Œå¾ˆå¥½åƒè€¶ï¼</div>
                </div>
            </div>

            <!-- Shen Fu Row -->
            <div class="chat-row shen">
                <svg class="avatar-svg" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="45" fill="#f1f2f6" stroke="#2d3436" stroke-width="2"/>
                    <rect x="25" y="10" width="50" height="30" fill="#2d3436" rx="5"/>
                    <circle cx="35" cy="55" r="3" fill="#333"/> <circle cx="65" cy="55" r="3" fill="#333"/>
                    <path d="M40,75 L60,75" stroke="#333" stroke-width="2"/> <!-- Serious Mouth -->
                </svg>
                <div class="chat-bubble" onclick="nextChatState(this)">
                    <div class="placeholder">...</div>
                    <div class="chat-text">ã€Œç„¶å‰‡æˆ‘å®¶ä¿‚ç‹—ç«‡è€¶ï¼Ÿã€</div>
                    <div class="chat-trans">ç…§ä½ é€™æ¨£èªªï¼Œé‚£æˆ‘å€‘å®¶è±ˆä¸æ˜¯ç‹—çª©äº†å—ï¼Ÿ</div>
                </div>
            </div>

            <!-- Yun Niang Row -->
            <div class="chat-row yun">
                <svg class="avatar-svg" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="45" fill="#fff0f5" stroke="#fd79a8" stroke-width="2"/>
                    <circle cx="20" cy="40" r="15" fill="#2d3436"/> <circle cx="80" cy="40" r="15" fill="#2d3436"/>
                    <path d="M20,40 Q50,-10 80,40" fill="#2d3436"/>
                    <circle cx="35" cy="60" r="3" fill="#333"/> <circle cx="65" cy="60" r="3" fill="#333"/>
                    <circle cx="40" cy="75" r="5" fill="#fd79a8" opacity="0.5"/> <!-- Blush -->
                    <circle cx="60" cy="75" r="5" fill="#fd79a8" opacity="0.5"/>
                </svg>
                <div class="chat-bubble" onclick="nextChatState(this)">
                    <div class="placeholder">...</div>
                    <div class="chat-text">ã€Œå¦¾ä½œç‹—ä¹…çŸ£ï¼Œå±ˆå›è©¦å˜—ä¹‹ã€‚ã€</div>
                    <div class="chat-trans">æˆ‘éƒ½ç•¶é€™éº¼ä¹…çš„ç‹—äº†ï¼Œå§”å±ˆä½ ä¹Ÿç•¶ä¸€ä¸‹ç‹—å§ï¼(å¼·å¡)</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Slide 5: ä¸‰æ­¥é©Ÿ -->
    <div class="slide" id="s5">
        <h2>ğŸ¤ª çœŸé¦™ä¸‰éƒ¨æ›²</h2>
        <div class="step-container">
            <div class="step-box" id="step1" onclick="activateStep(1)">
                <div style="font-size:5rem;">âœ‹ğŸ‘ƒ</div>
                <h3>1. æ©é¼»å’€åš¼</h3>
                <p>æè‘—é¼»å­åƒ</p>
            </div>
            <div class="step-box" id="step2" onclick="activateStep(2)">
                <div style="font-size:5rem;">ğŸ‘ƒâœ¨</div>
                <h3>2. é–‹é¼»å†åš¼</h3>
                <p>å¥½åƒä¸éŒ¯ï¼Ÿ</p>
            </div>
            <div class="step-box" id="step3" onclick="activateStep(3)">
                <div style="font-size:5rem;">ğŸ¤¤â¤ï¸</div>
                <h3>3. ç«Ÿæˆç•°å‘³</h3>
                <p>å¤ªå¥½åƒäº†ï¼</p>
            </div>
        </div>
    </div>

    <!-- Slide 6: ç‰¹è³ªåˆ†é¡ (æ›´æ–°æ‹–æ›³åŠŸèƒ½) -->
    <div class="slide" id="s6">
        <h2>ğŸ§  å¤«å¦»é»˜å¥‘å¤§è€ƒé©—</h2>
        <p>è«‹å°‡ç‰¹è³ªå¡æ‹–æ›³(æˆ–é»æ“Š)æ”¾å…¥ä¸‹æ–¹æ­£ç¢ºçš„æ¡†æ¡†ä¸­ï¼</p>
        
        <div class="sort-game-container">
            <button id="check-btn" onclick="checkAnswers()">å®Œæˆä½œç­” âœ…</button>

            <!-- å€åŸŸï¼šæ²ˆå¾© -->
            <div class="zone shen" id="zone-shen" data-target="shen" onclick="zoneClick('shen')">
                <!-- Shen Fu SVG Avatar -->
                <svg width="100" height="100" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="45" fill="#f1f2f6" stroke="#2d3436" stroke-width="2"/>
                    <rect x="25" y="10" width="50" height="30" fill="#2d3436" rx="5"/>
                    <circle cx="35" cy="55" r="3" fill="#333"/> <circle cx="65" cy="55" r="3" fill="#333"/>
                    <path d="M40,70 Q50,80 60,70" stroke="#333" stroke-width="2" fill="none"/>
                </svg>
                <h3>æ²ˆå¾©</h3>
                <div class="zone-content" id="content-shen"></div>
            </div>
            
            <!-- å€åŸŸï¼šèŠ¸å¨˜ -->
            <div class="zone yun" id="zone-yun" data-target="yun" onclick="zoneClick('yun')">
                <!-- Yun Niang SVG Avatar -->
                <svg width="100" height="100" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="45" fill="#fff0f5" stroke="#fd79a8" stroke-width="2"/>
                    <circle cx="20" cy="40" r="15" fill="#2d3436"/> <circle cx="80" cy="40" r="15" fill="#2d3436"/>
                    <path d="M20,40 Q50,-10 80,40" fill="#2d3436"/>
                    <circle cx="35" cy="60" r="3" fill="#333"/> <circle cx="65" cy="60" r="3" fill="#333"/>
                    <rect x="75" y="30" width="20" height="4" fill="#fd79a8" transform="rotate(-20)"/>
                </svg>
                <h3>èŠ¸å¨˜</h3>
                <div class="zone-content" id="content-yun"></div>
            </div>
            
            <!-- å¾…é¸ç‰Œå¡å€ -->
            <div class="deck-area" id="deck"></div>
        </div>

        <!-- æ¨¡æ…‹æ¡† -->
        <div class="modal-overlay" id="result-modal">
            <div class="modal-box">
                <h2 id="modal-title"></h2>
                <p id="modal-msg"></p>
                <button class="ctrl-btn" onclick="closeModal()">ç¢ºå®š</button>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="nav-controls">
        <div class="nav-btn disabled" id="btn-prev" onclick="move(-1)">â®</div>
        <div style="flex:1"></div>
        <div class="nav-btn" id="btn-next" onclick="move(1)">â¯</div>
    </div>
</div>

<script>
    // === æ ¸å¿ƒå°èˆª ===
    let currentSlide = 0;
    const slides = document.querySelectorAll('.slide');
    const btnPrev = document.getElementById('btn-prev');
    const btnNext = document.getElementById('btn-next');

    function move(dir) {
        let nextIndex = currentSlide + dir;
        if (nextIndex < 0 || nextIndex >= slides.length) return;
        slides[currentSlide].classList.remove('active');
        currentSlide = nextIndex;
        slides[currentSlide].classList.add('active');
        updateNav();
        
        // Canvas Resize
        if(currentSlide === 2) setTimeout(resizeCanvas, 100);
        // Game Init
        if(currentSlide === 5) initSortGame();
    }

    function updateNav() {
        if(currentSlide === 0) btnPrev.classList.add('disabled');
        else btnPrev.classList.remove('disabled');

        if(currentSlide === slides.length - 1) {
             btnNext.innerHTML = "ğŸ";
             btnNext.onclick = () => alert('èª²ç¨‹çµæŸï¼è¬è¬å¤§å®¶ï¼');
        } else {
             btnNext.innerHTML = "â¯";
             btnNext.onclick = () => move(1);
        }
    }

    // === Slide 3: ç•«å¸ƒ (ä½ ç•«æˆ‘çŒœ) ===
    const canvas = document.getElementById('drawing-board');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;
    let lastX = 0; let lastY = 0;

    function resizeCanvas() {
        const parent = canvas.parentElement;
        canvas.width = parent.clientWidth;
        canvas.height = parent.clientHeight;
        ctx.lineCap = 'round'; ctx.lineJoin = 'round'; ctx.lineWidth = 6; ctx.strokeStyle = 'black';
    }

    // æ”¯æ´æ»‘é¼ èˆ‡è§¸æ§
    function getPos(e) {
        const rect = canvas.getBoundingClientRect();
        if(e.touches) {
            return { x: e.touches[0].clientX - rect.left, y: e.touches[0].clientY - rect.top };
        }
        return { x: e.offsetX, y: e.offsetY };
    }

    function startDraw(e) { 
        e.preventDefault(); isDrawing = true; 
        const pos = getPos(e); lastX = pos.x; lastY = pos.y; 
    }
    function draw(e) {
        if (!isDrawing) return; e.preventDefault();
        const pos = getPos(e);
        ctx.beginPath(); ctx.moveTo(lastX, lastY); ctx.lineTo(pos.x, pos.y); ctx.stroke();
        lastX = pos.x; lastY = pos.y;
    }
    function stopDraw() { isDrawing = false; }
    
    canvas.addEventListener('mousedown', startDraw);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDraw);
    canvas.addEventListener('touchstart', startDraw, {passive: false});
    canvas.addEventListener('touchmove', draw, {passive: false});
    canvas.addEventListener('touchend', stopDraw);

    function clearCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); }
    function setColor(color, btn) {
        ctx.strokeStyle = color;
        document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    // === Slide 4: èŠå¤©äº’å‹• ===
    // State: 0 (Placeholder) -> 1 (Text) -> 2 (Translation)
    function nextChatState(el) {
        const placeholder = el.querySelector('.placeholder');
        const text = el.querySelector('.chat-text');
        const trans = el.querySelector('.chat-trans');
        
        // æª¢æŸ¥ç›®å‰ç‹€æ…‹
        if(placeholder.style.display !== 'none') {
            // State 0 -> 1
            placeholder.style.display = 'none';
            text.style.display = 'block';
            setTimeout(() => text.style.opacity = 1, 10);
        } else if(trans.style.display !== 'block') {
            // State 1 -> 2
            trans.style.display = 'block';
            setTimeout(() => trans.style.opacity = 1, 10);
        }
    }

    // === Slide 5: ä¸‰æ­¥é©Ÿ ===
    function activateStep(n) {
        document.querySelectorAll('.step-box').forEach(b => b.classList.remove('active'));
        for(let i=1; i<=n; i++) document.getElementById(`step${i}`).classList.add('active');
    }

    // === Slide 6: ç‰¹è³ªåˆ†é¡ (Drag & Drop) ===
    const traits = [
        { id: 1, txt: "å–œé£Ÿè’œ", target: "shen" },
        { id: 2, txt: "å–œé£Ÿè…ä¹³", target: "yun" },
        { id: 3, txt: "èªªè©±æ¯’èˆŒ", target: "shen" },
        { id: 4, txt: "å€‹æ€§å¼·å‹¢", target: "yun" },
        { id: 5, txt: "å‹‡æ–¼å˜—è©¦", target: "shen" },
        { id: 6, txt: "æ„›é–‹ç©ç¬‘", target: "yun" }
    ];
    let selectedCard = null;
    let placedCount = 0;

    function initSortGame() {
        const deck = document.getElementById('deck');
        document.getElementById('content-shen').innerHTML = '';
        document.getElementById('content-yun').innerHTML = '';
        deck.innerHTML = '';
        placedCount = 0;
        document.getElementById('check-btn').style.display = 'none';

        traits.forEach((t) => {
            let card = document.createElement('div');
            card.className = 'trait-card';
            card.innerText = t.txt;
            card.id = `card-${t.id}`;
            card.dataset.target = t.target;
            
            // é»æ“Šäº‹ä»¶ (èˆŠæœ‰é‚è¼¯ä¿ç•™ä»¥é˜²è¬ä¸€)
            card.onclick = (e) => selectCardClick(e, card);

            // æ‹–æ›³äº‹ä»¶ (æ»‘é¼  & è§¸æ§)
            setupDrag(card);

            deck.appendChild(card);
        });
    }

    // æ‹–æ›³é‚è¼¯
    function setupDrag(el) {
        let offsetX, offsetY, startX, startY;
        
        const startDrag = (e) => {
            // é˜»æ“‹é è¨­ï¼Œä½†å¦‚æœé»æ“Šä¸è¦è§¸ç™¼æ‹–æ›³(ç”¨è·é›¢åˆ¤æ–·)
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            startX = clientX; startY = clientY;
            
            const rect = el.getBoundingClientRect();
            offsetX = clientX - rect.left;
            offsetY = clientY - rect.top;
            
            el.style.position = 'fixed';
            el.style.zIndex = 1000;
            el.style.width = rect.width + 'px'; // ä¿æŒå¯¬åº¦
            
            moveAt(clientX, clientY);
            
            document.addEventListener('mousemove', onMove);
            document.addEventListener('touchmove', onMove, {passive: false});
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchend', endDrag);
        };

        const moveAt = (x, y) => {
            el.style.left = (x - offsetX) + 'px';
            el.style.top = (y - offsetY) + 'px';
            
            // åµæ¸¬ Hover Zone
            checkHover(x, y);
        };

        const onMove = (e) => {
            e.preventDefault();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            moveAt(clientX, clientY);
        };

        const endDrag = (e) => {
            document.removeEventListener('mousemove', onMove);
            document.removeEventListener('touchmove', onMove);
            document.removeEventListener('mouseup', endDrag);
            document.removeEventListener('touchend', endDrag);

            el.style.zIndex = '';
            
            // åˆ¤æ–·æ˜¯å¦åœ¨å€åŸŸå…§
            const zones = document.querySelectorAll('.zone');
            let dropped = false;
            
            // å–å¾—æœ€å¾Œä½ç½® (è‹¥æ˜¯ TouchEnd, éœ€ç”¨æ”¹è®Šå¾Œçš„åº§æ¨™æˆ–æœ€è¿‘ä¸€æ¬¡ Move)
            // ç°¡åŒ–ï¼šç›´æ¥ç”¨å…ƒç´ ä¸­å¿ƒé»åˆ¤æ–·
            const rect = el.getBoundingClientRect();
            const centerX = rect.left + rect.width/2;
            const centerY = rect.top + rect.height/2;

            zones.forEach(z => {
                const zRect = z.getBoundingClientRect();
                if(centerX > zRect.left && centerX < zRect.right && 
                   centerY > zRect.top && centerY < zRect.bottom) {
                    // æ”¾å…¥å€åŸŸ
                    z.querySelector('.zone-content').appendChild(el);
                    el.style.position = 'static';
                    el.style.left = ''; el.style.top = '';
                    dropped = true;
                }
                z.classList.remove('hover');
            });

            if(!dropped) {
                // å›åˆ°ç‰Œåº«
                document.getElementById('deck').appendChild(el);
                el.style.position = 'static';
            }
            
            checkCompletion();
        };

        el.addEventListener('mousedown', startDrag);
        el.addEventListener('touchstart', startDrag, {passive: false});
    }

    function checkHover(x, y) {
        document.querySelectorAll('.zone').forEach(z => {
            const rect = z.getBoundingClientRect();
            if(x > rect.left && x < rect.right && y > rect.top && y < rect.bottom) {
                z.classList.add('hover');
            } else {
                z.classList.remove('hover');
            }
        });
    }

    // é»æ“Šé¸æ“‡é‚è¼¯ (è¼”åŠ©)
    function selectCardClick(e, card) {
        if(card.style.position === 'fixed') return; // æ­£åœ¨æ‹–æ›³
        if(selectedCard === card) {
            selectedCard.style.border = "none";
            selectedCard = null;
        } else {
            if(selectedCard) selectedCard.style.border = "none";
            selectedCard = card;
            card.style.border = "3px solid #fd79a8";
        }
    }

    function zoneClick(target) {
        if(selectedCard) {
            document.getElementById(`content-${target}`).appendChild(selectedCard);
            selectedCard.style.border = "none";
            selectedCard = null;
            checkCompletion();
        }
    }

    function checkCompletion() {
        const deck = document.getElementById('deck');
        if(deck.children.length === 0) {
            document.getElementById('check-btn').style.display = 'block';
        } else {
            document.getElementById('check-btn').style.display = 'none';
        }
    }

    function checkAnswers() {
        const shenCards = Array.from(document.getElementById('content-shen').children);
        const yunCards = Array.from(document.getElementById('content-yun').children);
        let allCorrect = true;

        // æª¢æŸ¥æ²ˆå¾©å€
        shenCards.forEach(c => {
            if(c.dataset.target !== 'shen') {
                allCorrect = false;
                c.classList.add('wrong');
            } else {
                c.classList.add('correct');
            }
        });

        // æª¢æŸ¥èŠ¸å¨˜å€
        yunCards.forEach(c => {
            if(c.dataset.target !== 'yun') {
                allCorrect = false;
                c.classList.add('wrong');
            } else {
                c.classList.add('correct');
            }
        });

        const modal = document.getElementById('result-modal');
        const title = document.getElementById('modal-title');
        const msg = document.getElementById('modal-msg');
        modal.style.display = 'flex';

        if(allCorrect) {
            title.innerText = "ğŸ‰ å…¨å°å•¦ï¼å¤ªå¼·äº†ï¼";
            title.style.color = "#00b894";
            msg.innerHTML = "è©³è§£ï¼š<br>æ²ˆå¾©ï¼šæ„›åƒè’œã€å˜´å·´å£ã€å¾Œä¾†ä¹Ÿæ•¢åƒäº†ã€‚<br>èŠ¸å¨˜ï¼šæ„›åƒè‡­è±†è…ã€å¼·å‹¢åˆå¯æ„›ã€‚";
            // ç­”å°é–å®šéŠæˆ²
            document.getElementById('check-btn').style.display = 'none';
        } else {
            title.innerText = "âŒ å“å‘€ï¼Œæœ‰å¹¾å€‹æ”¾éŒ¯å›‰ï¼";
            title.style.color = "#d63031";
            msg.innerText = "ç´…è‰²çš„å¡ç‰‡æ”¾éŒ¯ä½ç½®äº†ï¼Œå†è©¦ä¸€æ¬¡çœ‹çœ‹ï¼Ÿ(æç¤ºï¼šèª°å–œæ­¡åƒè‡­è±†è…ï¼Ÿ)";
            
            // ç­”éŒ¯é‚è¼¯ï¼šç¨å¾Œé‡ç½®éŒ¯èª¤çš„å¡ç‰‡
            window.resetWrongCards = () => {
                const wrongCards = document.querySelectorAll('.trait-card.wrong');
                wrongCards.forEach(c => {
                    c.classList.remove('wrong');
                    document.getElementById('deck').appendChild(c);
                });
                document.getElementById('check-btn').style.display = 'none';
            };
        }
    }

    function closeModal() {
        document.getElementById('result-modal').style.display = 'none';
        if(window.resetWrongCards) {
            window.resetWrongCards();
            window.resetWrongCards = null;
        }
    }

</script>
</body>
</html>
